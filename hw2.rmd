---
title: "Visual Data Exploration"
author: "Bridget Viravouth & Vinny Nguyen"
date: "2025-05-01"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls()) # to rm all variables from the environment

library(tidyverse)
library(ggplot2)
library(dplyr)
library(tidyquery) # for SQL queries in R
```

```{r}
df <- read_csv("https://www.ics.uci.edu/~algol/teaching/s2022-IV/fec_2008-2022.csv")

glimpse(df)
```

```{r party affiliation + office} 
party_table <- query("SELECT Cand_Party_Affiliation AS Party, COUNT(*) AS Count
FROM df
WHERE Cand_Office = 'P'
GROUP BY Party
ORDER BY Count DESC
LIMIT 5")

party_table

# Create a bar plot of the top 5 political parties
ggplot(data = party_table) + geom_col(mapping = aes(x = reorder(Party, -Count), y = Count, fill = Party)) +
  labs(x = "Political Party", y = "Number of Presedential Candidates")

ggsave("plots/president_plot.png", width = 8, height = 6, dpi = 300)
```

```{r}
# ok this isnt working 
# maybe like dist of money spent for each party ?
hi <- query("SELECT DISTINCT Cand_Id, Cand_Name, Cand_Office, Cand_Party_Affiliation, Individual_Contribution
FROM df
WHERE Cand_Office = 'P' AND Cand_Party_Affiliation = 'DEM' OR Cand_Party_Affiliation = 'REP'")
hi

# log scale doesnt work because there are A LOT of 0 values. log scale cannot handle any 0s
ggplot(hi, aes(x = Individual_Contribution, fill = Cand_Party_Affiliation, color = Cand_Party_Affiliation)) + 
  geom_density(alpha = 0.7) +
  labs(x = "Individual Contribution (USD)",
    y = 'Density',
    title = 'hi') +
  scale_x_sqrt() +
  scale_y_sqrt() +
  scale_fill_brewer(palette = "Set2") +
  scale_color_brewer(palette = "Set2")
```

```{r}
# this also doesnt work
rep <- query("SELECT DISTINCT Cand_Id, Cand_Name, Cand_Office, Cand_Party_Affiliation, Individual_Contribution
FROM df
WHERE Cand_Office = 'P' AND Cand_Party_Affiliation = 'REP'")

dem <- query("SELECT DISTINCT Cand_Id, Cand_Name, Cand_Office, Cand_Party_Affiliation, Individual_Contribution
FROM df
WHERE Cand_Office = 'P' AND Cand_Party_Affiliation = 'DEM'")

ggplot(dem, aes(x = Individual_Contribution)) +
    geom_density(aes(x = Individual_Contribution, y = after_stat(density)), 
                fill = "#404080", 
                color = "#404080", 
                alpha = 0.5) +
    geom_label(aes(x = 63, y = 0.03, label = "Democrats"), 
              color = "#404080") + 
    geom_density(data = rep, 
                aes(x = Individual_Contribution, y = -after_stat(density)), 
                fill = "red", 
                color = "red", 
                alpha = 0.5) +
    geom_label(aes(x = 63, y = -0.025, label = "Republicans"), 
              color = "red")
```

```{r}
# HOW DO I FIX THE SCALE OH MY GODDDDDDD
dem <- query("SELECT DISTINCT Cand_Id, Cand_Name, Cand_Office, Cand_Party_Affiliation, Individual_Contribution
FROM df
WHERE Cand_Office = 'P' AND Cand_Party_Affiliation = 'DEM'")

ggplot(dem, aes(x = Individual_Contribution)) +
    geom_density(aes(x = Individual_Contribution, y = after_stat(density)), 
                fill = "#404080", 
                color = "#404080", 
                alpha = 0.5) +
    geom_label(aes(x = 63, y = 0.03, label = "Democrats"), 
              color = "#404080") + 
    scale_x_sqrt() +
    scale_y_sqrt()
```

```{r}
df <- df %>%
  rename(Party = Cand_Party_Affiliation)

q1 <- query("SELECT Cand_Id, Total_Contribution, Total_Loan, Party, Cand_Office
FROM df
WHERE (Total_Contribution > 0 AND Total_Loan > 0) AND Cand_Office = 'P'")
q1

ggplot(q1, aes(x = Total_Contribution, y = Total_Loan, 
               color = Party, 
               fill = Party)) +
  geom_point(alpha = 0.7, size = 5) +
  labs(x = "Total Campaign Contributions (USD)",
       y = "Total Campaign Loans (USD)",
       title = "Contributions vs Loans",
       subtitle = "Presidential Candidates Only") +
  scale_x_log10(labels = scales::label_number(prefix = "$", 
                                            big.mark = ",",
                                            accuracy = 1,)) +
  scale_y_log10(labels = scales::label_number(prefix = "$", 
                                            big.mark = ",",
                                            accuracy = 1)) +
  theme(
    axis.text = element_text(size = 15), # numbers
    axis.title = element_text(size = 20),
    plot.title = element_text(size = 25, face = "bold"),
    plot.subtitle = element_text(size = 18),
  )

ggsave("plots/loan_vs_contributions_pres.png", width = 8, height = 6, dpi = 300)
```

```{r}
df <- df %>%
  rename(Party = Cand_Party_Affiliation,
         Office = Cand_Office)

df$Office[df$Office == "P"] <- "President"
df$Office[df$Office == "S"] <- "Senate"
df$Office[df$Office == "H"] <- "House"


q2 <- query("SELECT Cand_Id, Total_Contribution, Total_Loan, Party, Office
FROM df
WHERE (Total_Contribution > 0 AND Total_Loan > 0)")

q2

ggplot(q2, aes(x = Total_Contribution, y = Total_Loan,
               color = Office,
               fill = Office)) +
  geom_point(alpha = 0.5, size = 5) +
  labs(x = "Total Campaign Contributions (USD)",
       y = "Total Campaign Loans (USD)",
       title = "Contributions vs Loans") +
  facet_grid(Office ~ .) +  # Changed from facet_wrap to facet_grid
  scale_x_log10(labels = scales::label_number(prefix = "$", 
                                            big.mark = ",",
                                            accuracy = 1)) +
  scale_y_log10(labels = scales::label_number(prefix = "$", 
                                            big.mark = ",",
                                            accuracy = 1)) +
  theme(
    axis.text = element_text(size = 15),
    axis.title = element_text(size = 20),
    plot.title = element_text(size = 25, face = "bold"),
    plot.subtitle = element_text(size = 18),
    strip.text = element_text(size = 16)  # Added to control facet label size
  )

# Adjust height to accommodate vertical stacking
ggsave("plots/stacked_office_plots.png", width = 8, height = 12, dpi = 300)
```

```{r}
q3 <- query("")
```